<!DOCTYPE html>
<html>
<head>
    <title>Salesforce Chat Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
</head>
<body>
    <h1>My Test Website</h1>
    <p>Testing my Salesforce Live Agent Chat...</p>
	
	<button id="liveChatBtn" type="button">Live Chat with Infra</button>

	<div id="askInfraModal" style="display:none; position:fixed; top:40%; left:40%; background:white; border:1px solid #333; padding:20px; z-index:9999;">
		<p>Have you tried Ask Infra?</p>
		<button id="askYes">Yes</button>
		<button id="askNo">No</button>
	</div>

	<script>
		const liveBtn = document.getElementById("liveChatBtn");
const modal = document.getElementById("askInfraModal");
const yes = document.getElementById("askYes");
const no = document.getElementById("askNo");

let isAgentAvailable = false; // Default to false

// 1. Listen for Salesforce to report availability status automatically
window.addEventListener("onEmbeddedServiceConfigurationDataRetrieved", (event) => {
    console.log("Salesforce Configuration Received:", event.detail);
    isAgentAvailable = event.detail.isAvailable;
});

liveBtn.addEventListener("click", function() {
    modal.style.display = "block";
});

no.addEventListener("click", function() {
    window.location.href = "https://yaqs.corp.google.com/silicon/q/new?tag=infra";
});

// 2. Logic for the YES button
yes.addEventListener("click", function() {
    modal.style.display = "none";

    if (isAgentAvailable) {
        // If Salesforce told us someone is online
        if (window.embeddedservice_bootstrap && embeddedservice_bootstrap.utilAPI) {
            embeddedservice_bootstrap.utilAPI.launchChat();
        }
    } else {
        // If Salesforce told us everyone is offline
        alert("All support agents are currently unavailable or offline. Please try again later.");
    }
});

	</script>
	
<script type='text/javascript'>
	function initEmbeddedMessaging() {
		try {
			embeddedservice_bootstrap.settings.language = 'en_US'; // For example, enter 'en' or 'en-US'
embeddedservice_bootstrap.settings.hideChatButtonOnLoad = true;
			embeddedservice_bootstrap.init(
				'00DDE0000044T2w',
				'New_Infra_Support',
				'https://silicon4--chattest3.sandbox.my.site.com/ESWNewInfraSupport1769449481682',
				{
					scrt2URL: 'https://silicon4--chattest3.sandbox.my.salesforce-scrt.com'
				}
			);
		} catch (err) {
			console.error('Error loading Embedded Messaging: ', err);
		}
	};
</script>
<script type='text/javascript' src='https://silicon4--chattest3.sandbox.my.site.com/ESWNewInfraSupport1769449481682/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>

    </body>
</html>
