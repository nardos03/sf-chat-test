<!DOCTYPE html>
<html>
<head>
    <title>Salesforce Chat Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
</head>
<body>
    <h1>My Test Website</h1>
    <p>Testing my Salesforce Live Agent Chat...</p>
	
	<button id="liveChatBtn" type="button">Live Chat with Infra</button>

	<div id="askInfraModal" style="display:none; position:fixed; top:40%; left:40%; background:white; border:1px solid #333; padding:20px; z-index:9999;">
		<p>Have you tried Ask Infra?</p>
		<button id="askYes">Yes</button>
		<button id="askNo">No</button>
	</div>

	<script>
		const liveBtn = document.getElementById("liveChatBtn");
		const modal = document.getElementById("askInfraModal");
		const yes = document.getElementById("askYes");
		const no = document.getElementById("askNo");

		liveBtn.addEventListener("click", function() {
			modal.style.display = "block";
		});

		//NO = redirect to YAQs site
		no.addEventListener("click", function() {
			window.location.href = "https://yaqs.corp.google.com/silicon/q/new?tag=infra";
		});

		//YES = open Salesforce chat ONLY if agents are online
yes.addEventListener("click", function() {
    modal.style.display = "none";

    if (window.embeddedservice_bootstrap && embeddedservice_bootstrap.utilAPI) {
       
        // Trying the alternative function name for Enhanced Messaging
        embeddedservice_bootstrap.utilAPI.checkAvailability().then((result) => {
            console.log("Availability Result:", result);

            if (result && result.isAvailable) {
                embeddedservice_bootstrap.utilAPI.launchChat();
            } else {
                alert("All support agents are currently unavailable or offline. Please try again later.");
            }
        }).catch((err) => {
            console.error("Chat Availability Error:", err);
            // If the function fails entirely, we'll default to the alert for safety
            alert("All support agents are currently unavailable or offline. Please try again later.");
        });

    } else {
        alert("Chat system not ready.");
    }
});
		
	</script>
	
<script type='text/javascript'>
	function initEmbeddedMessaging() {
		try {
			embeddedservice_bootstrap.settings.language = 'en_US'; // For example, enter 'en' or 'en-US'
embeddedservice_bootstrap.settings.hideChatButtonOnLoad = true;
			embeddedservice_bootstrap.init(
				'00DDE0000044T2w',
				'New_Infra_Support',
				'https://silicon4--chattest3.sandbox.my.site.com/ESWNewInfraSupport1769449481682',
				{
					scrt2URL: 'https://silicon4--chattest3.sandbox.my.salesforce-scrt.com'
				}
			);
		} catch (err) {
			console.error('Error loading Embedded Messaging: ', err);
		}
	};
</script>
<script type='text/javascript' src='https://silicon4--chattest3.sandbox.my.site.com/ESWNewInfraSupport1769449481682/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>

    </body>
</html>
