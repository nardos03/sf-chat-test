<!DOCTYPE html>
<html>
<head>
  <title>Salesforce Chat Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
</head>
<body>

<h1>My Test Website</h1>
<p>Testing Salesforce Embedded Messaging</p>

<button id="liveChatBtn">Live Chat with Infra</button>

<div id="askInfraModal" style="display:none; position:fixed; top:40%; left:40%; background:white; border:1px solid #333; padding:20px; z-index:9999;">
  <p>Have you tried Ask Infra?</p>
  <button id="askYes">Yes</button>
  <button id="askNo">No</button>
</div>

<script>
/***********************
 * Modal logic
 ***********************/
const liveBtn = document.getElementById("liveChatBtn");
const modal = document.getElementById("askInfraModal");
const yes = document.getElementById("askYes");
const no = document.getElementById("askNo");

liveBtn.onclick = () => modal.style.display = "block";

no.onclick = () => {
  window.location.href = "https://yaqs.corp.google.com/silicon/q/new?tag=infra";
};

let isMessagingReady = false;

yes.onclick = () => {
  modal.style.display = "none";
  launchWhenReady();
};

function launchWhenReady() {
  if (!isMessagingReady || !window.embeddedservice_bootstrap?.utilAPI) {
    console.log("‚è≥ Waiting for Embedded Messaging to load...");
    setTimeout(launchWhenReady, 500);
    return;
  }

  console.log("üöÄ Launching chat");
  embeddedservice_bootstrap.utilAPI.launchChat();
}

/***********************
 * Embedded Messaging Ready
 ***********************/
window.addEventListener("onEmbeddedMessagingReady", () => {
  console.log("‚úÖ Embedded Messaging Ready");

  isMessagingReady = true;

  embeddedservice_bootstrap.prechatAPI.setVisiblePrechatFields({
    "_email": {
      value: "nardosa@google.com",
      isEditableByEndUser: true
    },
    "_firstName": {
      value: "Nardos",
      isEditableByEndUser: true
    },
    "_lastName": {
      value: "Assefa",
      isEditableByEndUser: true
    },
    "_subject": {
      value: "",
      isEditableByEndUser: true
    }
  });
});

/***********************
 * Init Embedded Messaging
 ***********************/
function initEmbeddedMessaging() {
  try {
    embeddedservice_bootstrap.settings.language = "en_US";
    embeddedservice_bootstrap.settings.hideChatButtonOnLoad = true;

    embeddedservice_bootstrap.init(
      "00DDE0000044T2w",
      "New_Infra_Support",
      "https://silicon4--chattest3.sandbox.my.site.com/ESWNewInfraSupport1769449481682",
      {
        scrt2URL: "https://silicon4--chattest3.sandbox.my.salesforce-scrt.com"
      }
    );
  } catch (err) {
    console.error("‚ùå Error loading Embedded Messaging:", err);
  }
}
</script>

<script
  type="text/javascript"
  src="https://silicon4--chattest3.sandbox.my.site.com/ESWNewInfraSupport1769449481682/assets/js/bootstrap.min.js"
  onload="initEmbeddedMessaging()">
</script>

</body>
</html>
